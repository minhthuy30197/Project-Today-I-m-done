<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Today I'm done</title>
    <link rel="stylesheet" href="assests/css/test.css">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="assests/js/pomo.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        li.borderless {
            border-top: 0 none;
            border-right: 0 none;
            border-left: 0 none;
        }

        .list-group-item {
            background-color: transparent;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-default" role="navigation" style="opacity:0.8 ">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"><span class="glyphicon glyphicon-check gi-2x"></span> <span class="text30">Today I'm done</span></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#" data-toggle="modal" data-target="#modalSettings">
                    <span class="glyphicon glyphicon-cog gi-2x"></span></a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="text20"></span><b
                            class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li><a href="#" data-toggle="modal" data-target="#modalProfile"><span
                                    class="glyphicon glyphicon-pencil"></span> Change profile</a></li>
                    <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Log out</a></li>
                </ul>
            </li>
        </ul>
    </div><!-- /.navbar-collapse -->
</nav>
<br>
<br>
<div class="container">
    <div class="row">
        <div class="col-md-10 col-md-push-1 well">
            <div class="col-md-7">
                <div class="listtask">
                    <div class="title">
                        <h3>Make my date</h3>
                        <p>
                            <script> document.write(new Date().toDateString()) </script>
                        </p>
                    </div>
                    <ul class="list-group" id="task-list">
                        <li class="list-group-item borderless">
                            <img src="assests/images/plus1.png" class="img-responsive" style="float: left">
                            &nbsp;
                            <input type="text" id="newtask" class="addTask-input"
                                   placeholder="Input new task and press ENTER to add..." value="">
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-5">
                <div class="pomodoro">
                    <div class="settings">
                        <table width="100%">
                            <tr>
                                <td>
                                    <p>
                                        Break Length
                                        <br>
                                        <button class="break" id="breakSub">-</button>
                                        <span class="break" id="breakTime">5</span>
                                        <button class="break" id="breakAdd">+</button>
                                    </p>
                                </td>
                                <td>
                                    <p>
                                        Session Length
                                        <br>
                                        <button id="totSub">-</button>
                                        <span id="totTime">25</span>
                                        <button id="totAdd">+</button>
                                    </p>
                                </td>
                            </tr>
                        </table>

                    </div>
                    <div class="clock">
                        <p id="time-display">25:00</p>
                        <p id="break-text" class="break-text">
                            Break!
                        </p>
                        <div class="newton-cradle">
                            <div id="leftBall" class="cord">
                                <div class="ball"></div>
                            </div>
                            <div class="cord">
                                <div class="ball"></div>
                            </div>
                            <div class="cord">
                                <div class="ball"></div>
                            </div>
                            <div class="cord">
                                <div class="ball"></div>
                            </div>
                            <div class="cord">
                                <div class="ball"></div>
                            </div>
                            <div class="cord">
                                <div class="ball"></div>
                            </div>
                            <div id="rightBall" class="cord">
                                <div class="ball" id="first"></div>
                            </div>
                        </div>
                    </div>
                    <div class="controls text-center">
                        <button type="button" id="stop">Stop</button>
                        <button type="button" id="start">Start</button>
                        <button type="button" id="reset">Reset</button>
                    </div>

                    <audio id="notify">
                        <source src="assests/notification.mp3" type="audio/mpeg"/>
                        <source src="assests/notification.ogg" type="audio/ogg"/>
                    </audio>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalSettings" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="modal-title"><b>Options</b></h2>
                </div>
                <div class="modal-body">
                    <h4><label for="ring">Select sound</label></h4><select class="form-control" id="ring">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                    </select>
                    <h4>Select volume <span class="glyphicon glyphicon-volume-up"></span></h4>
                    <div class="text-center">
                        <label class="radio-inline">
                            <input type="radio" name="optradio">25%
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="optradio">50%
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="optradio">75%
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="optradio">100%
                        </label>
                    </div>
                </div>
                <div class="modal-footer text-right">
                    <button class="btn btn-success" id="SaveSettings" type="submit">Save</button>
                    <button class="btn btn-default" id="ResetSettings" type="reset">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalProfile" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="modal-title"><b>Profile</b></h2>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <span class="input-group-addon">Full Name</span>
                        <input id="fullName" type="text" class="form-control" name="fullName"
                               placeholder="Your full name">
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">Email</span>
                        <input id="email" type="password" class="form-control" name="email"
                               placeholder="Your email">
                    </div>
                    <br>
                    <b>Change your password</b>
                    <div class="input-group">
                        <span class="input-group-addon">Your old password</span>
                        <input id="oldPassword" type="password" class="form-control" name="oldPassword"
                               placeholder="">
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">Your new password</span>
                        <input id="newPassword" type="text" class="form-control" name="newPassword"
                               placeholder="">
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">Retype new password</span>
                        <input id="retypePassword" type="password" class="form-control" name="retypePassword"
                               placeholder="">
                    </div>
                </div>
                <div class="modal-footer text-right">
                    <button class="btn btn-success" id="SaveProfile" type="submit">Save</button>
                    <button class="btn btn-default" id="ResetProfile" type="reset">Reset</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="modal-title"><b>My task</b></h2>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label for="task_id"></label><input type="text" hidden value="" id="task_id">
                        <span class="input-group-addon">My task</span>
                        <input id="task_modal_name" type="text" class="form-control" name="Task" placeholder="">
                    </div>
                </div>
                <div class="modal-footer text-right">
                    <button class="btn btn-success" id="SaveTask">Save</button>
                    <button class="btn btn-basic" id="DeleteTask" onclick="deleteTask()">Delete</button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</body>
</html>

<script>
  window.onload = function () {
    $.get('/gettask', (data) => {
      let arr = JSON.parse(data)
      let count = arr.tasks.length
      let i = 0
      while (i < count) {
        if (arr.tasks[i].done == true) $('#task-list').append(drawDoneTask(arr.tasks[i].id, arr.tasks[i].name))
        else $('#task-list').append(drawNotDoneTask(arr.tasks[i].id, arr.tasks[i].name))
        i++
      }
    })
  }

  function showInfo (id) {
    $.get('/task?id=' + id, (data) => {
      let obj = JSON.parse(data)
      $('#task_modal_name').val(obj.name)
      $('#task_id').val(obj.id)
      $('#myModal').modal()
    })
  }

  function deleteTask () {
    id = $('#task_id').val()
    let obj = {'id': id}
    $.ajax({
      type: 'POST',
      url: '/delete',
      data: obj,
      dataType: 'json',
      success: function (result) {
        if (result['result'] === 'success') {
          $('#myModal').modal('hide')
          $('#' + id).remove()
        }
      },
    })
  }

  function doneTask (id) {
    let obj = {'id': id}
    $.ajax({
      type: 'POST',
      url: '/done',
      data: obj,
      dataType: 'json',
      success: function (result) {
        if (result['result'] === 'success') {
          $('#' + id).replaceWith(drawDoneTask(id, result['name']))
        }
      },
    })
  }

  function resetTask (id) {
    let obj = {'id': id}
    $.ajax({
      type: 'POST',
      url: '/reset',
      data: obj,
      dataType: 'json',
      success: function (result) {
        if (result['result'] === 'success') {
          $('#' + id).replaceWith(drawNotDoneTask(id, result['name']))
        }
      },
    })
  }

  let newtask = document.getElementById('newtask')
  newtask.addEventListener('keyup', function (event) {
    event.preventDefault()
    if (event.keyCode === 13) {
      let name = $('#newtask').val()
      if (name === '') alert('Vui lòng nhập công việc!')
      else {
        let obj = {'name': name}
        $.ajax({
          type: 'POST',
          url: '/insert',
          data: obj,
          dataType: 'json',
          success: function (result) {
            if (result['result'] === 'success') {
              console.log(result['id'])
              $('#newtask').val('')
              $('#task-list').append(drawNotDoneTask(result['id'], name))
            }
          },
        })
      }
    }
  })

  $('#SaveTask').click(function () {
    let id = $('#task_id').val()
    let name = $('#task_modal_name').val()
    let obj = {'name': name, 'id': id}
    console.log(JSON.stringify(obj))
    $.ajax({
      type: 'POST',
      url: '/changetask',
      data: obj,
      dataType: 'json',
      success: function (result) {
        if (result['result'] === 'success') {
          $('#content' + id).text(name)
          $('#myModal').modal('hide')
        }
      },
    })
  })

  function drawDoneTask (id, name) {
    return '<li class="list-group-item borderless" id=\'' + id + '\'>\n' +
      '                        <div class="container-fluid">\n' +
      '                            <div class="row">\n' +
      '                                <input name="checkdone" checked type="checkbox" value="" class="largerCheckbox col-xs-3" onclick="resetTask(\'' +
      id + '\')">\n' +
      '                                <div class="contenttask col-xs-9" onclick="showInfo(\'' + id + '\')">\n' +
      '                                    <strike><p id=\'content' + id + '\'>' + name + '</p></strike>' +
      '                                </div>\n' +
      '                            </div>\n' +
      '                        </div>\n' +
      '                    </li>'
  }

  function drawNotDoneTask (id, name) {
    return '<li class="list-group-item borderless" id=\'' + id + '\'>\n' +
      '                        <div class="container-fluid">\n' +
      '                            <div class="row">\n' +
      '                                <input name="checkdone" type="checkbox" value="" class="largerCheckbox col-xs-3" onclick="doneTask(\'' +
      id + '\')">\n' +
      '                                <div class="contenttask col-xs-9" onclick="showInfo(\'' + id + '\')">\n' +
      '                                    <p id=\'content' + id + '\'>' + name + '</p>' +
      '                                </div>\n' +
      '                            </div>\n' +
      '                        </div>\n' +
      '                    </li>'
  }
</script>